{% extends "forum/base.html" %}
{% load forum_tags %}

{% block title %}Profili Düzenle{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card p-4">
                <div class="card-body">

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="text-center mb-4">
                            {% if profil.foto %}
                                <img src="{{ profil.foto.url }}" class="avatar avatar-lg" alt="Profil Fotoğrafı">
                            {% else %}
                                <img src="{% gravatar_url user.email 100 %}" class="avatar avatar-lg" alt="Profil Fotoğrafı">
                            {% endif %}
                            <h2 class="mt-3">Profili Düzenle</h2>
                        </div>

                        <fieldset class="form-group">
                            <legend class="border-bottom pb-2 mb-4">Hesap Bilgileri</legend>
                            
                            <div class="mb-3">
    <label class="form-label">Kullanıcı Adı</label>
    <p class="form-control-plaintext ps-0"><strong>{{ user.username }}</strong></p>
    <small class="text-muted">Kullanıcı adları değiştirilemez.</small>
</div>

                           <!-- profil_duzenle.html (DÜZELTİLMİŞ HALİ) -->
<!-- profil_duzenle.html (DÜZELTİLMİŞ HALİ) -->
<div class="mb-3">
    <label class="form-label">E-posta Adresi</label>
    <!-- 'form-control-plaintext' class'ını ve 'ps-0' ekledik -->
    <p class="form-control-plaintext ps-0">
        {% if user.emailaddress_set.all.0 %}
            {{ user.emailaddress_set.all.0.email }}
        {% else %}
            {{ user.email }}
        {% endif %}
    </p>
    <small class="text-muted">
        E-posta adresinizi yönetmek için lütfen <a href="{% url 'account_email' %}">E-posta Ayarları</a> sayfasını kullanın.
    </small>
</div>

                            <legend class="border-bottom pb-2 my-4">Profil Fotoğrafı</legend>
                            
                            <div class="mb-3">
    <label for="{{ p_form.foto.id_for_label }}" class="form-label">Yeni Fotoğraf Yükle</label>
    {{ p_form.foto }}
    {% if p_form.foto.errors %}<div class="invalid-feedback d-block">{{ p_form.foto.errors }}</div>{% endif %}
</div>
                        </fieldset>

                        <div class="d-grid mt-4">
                            <button class="btn btn-primary btn-lg" type="submit">Değişiklikleri Kaydet</button>
                        </div>
                    </form>
                </div>
            </div>
             <div class="text-center mt-4">
                <a href="{% url 'forum:profil' user.username %}" class="text-muted"><small>« Profile Geri Dön</small></a>
            </div>
        </div>
    </div>
</div>
{% endblock %}```
*   **Bonus Düzeltme:** Bir önceki versiyonda `<img>` etiketinden `avatar avatar-lg` class'larını kaldırmıştım. Onları geri ekledim. Bu, fotoğrafı olmayan kullanıcılar için bile Gravatar resminin doğru boyutta (100x100) görünmesini sağlar.

---

### Sonuç
Dosyayı bu şekilde kaydedip sunucuyu yeniden başlattıktan sonra, Django artık `gravatar_url` etiketini tanıyacak ve "Profili Düzenle" sayfası hatasız bir şekilde, düzgün bir şekilde yüklenecektir.