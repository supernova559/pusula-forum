{% load forum_tags %}

{% for yanit in cevaplar %}
<div class="d-flex mt-3 pt-3 border-top" id="cevap-{{ yanit.id }}">
    <img src="{% if yanit.yazan.profil and yanit.yazan.profil.foto %}{{ yanit.yazan.profil.foto.url }}{% else %}{% gravatar_url yanit.yazan.email 30 %}{% endif %}" class="me-3 avatar avatar-xs" alt="{{ yanit.yazan.username }}">
    <div class="w-100">
        <div>
            <a class="profil-linki" href="{% url 'forum:profil' yanit.yazan.username %}">{{ yanit.yazan.username }}</a>
            <small class="text-muted ms-1">· {{ yanit.yazilma_tarihi|timesince }} önce</small>
        </div>
        <p class="mb-1 mt-1">{{ yanit.icerik_html|safe }}</p>
        <div class="mt-2 d-flex align-items-center">
            {% if user.is_authenticated %}
            <a href="#" class="btn btn-sm btn-outline-secondary yanitla-butonu" data-cevap-id="{{ yanit.id }}" data-yazan="@{{ yanit.yazan.username }} ">
                <i class="fas fa-reply"></i> Yanıtla
            </a>
            {% endif %}
            <a href="{% url 'forum:begen_cevap' yanit.id %}" class="btn {% if user in yanit.begenenler.all %}btn-danger{% else %}btn-outline-danger{% endif %} btn-sm begen-butonu begen-butonu-yanit ms-2" data-yanit-id="{{ yanit.id }}">
                <i class="{% if user in yanit.begenenler.all %}fas{% else %}far{% endif %} fa-heart"></i>
                <span class="ms-1" id="begeni-sayaci-yanit-{{ yanit.id }}">{{ yanit.begenenler.count }}</span>
            </a>
        </div>

        <!-- RECURSIVE (KENDİNİ ÇAĞIRAN) BÖLÜM -->
        {% if yanit.yanitlar.all %}
            <div class="ms-4"> <!-- Girinti için -->
                {% include "forum/partials/yanit_listesi.html" with cevaplar=yanit.yanitlar.all %}
            </div>
        {% endif %}
    </div>
</div>
{% endfor %}