{% extends "forum/base.html" %}
{% load i18n %}

{% block title %}E-posta Adresini Değiştir{% endblock %}

{% block content %}

<!-- HATA AYIKLAMA KODU SONU -->
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card p-4">
                <div class="card-body">
                    <h2 class="card-title mb-2">E-posta Adresini Değiştir</h2>
                    {% load account %}
{% user_display user as user_display %}
                    <p class="text-muted mb-4">
    Mevcut birincil e-posta adresiniz: 
    <strong>
        <!-- Önce setin ilk elemanını almayı dene -->
        {% if user.emailaddress_set.all.0 %}
            {{ user.emailaddress_set.all.0.email }}
        <!-- Eğer o da yoksa, son çare olarak user.email'i dene -->
        {% else %}
            {{ user.email }}
        {% endif %}
    </strong>
</p>
                    
                    <p>Güvenlik nedeniyle, e-posta adresinizi değiştirmek için size bir doğrulama linki göndereceğiz. Lütfen yeni e-posta adresinizi girin.</p>

                    <form method="post" action="{% url 'account_email' %}" class="add_email">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="email" name="email" class="form-control" placeholder="yeni@eposta.com" required>
                            <button name="action_add" type="submit" class="btn btn-primary">Doğrulama Linki Gönder</button>
                        </div>
                        {% if form.errors %}
                            <div class="invalid-feedback d-block mt-2">{{ form.errors.email }}</div>
                        {% endif %}
                    </form>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="{% url 'forum:ayarlar' %}" class="text-muted"><small>« Ayarlar'a Geri Dön</small></a>
            </div>
        </div>
    </div>
</div>
{% endblock %}